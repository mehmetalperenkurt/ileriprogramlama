<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,  initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    
    <title>Map to HTML Table</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <script>
     if ('serviceWorker' in navigator) {
        navigator.serviceWorker
          .register('sw.js')
          .then((reg) => { console.log('SW Registered', reg) })
          .catch(console.log)
      }
  </script>
  <style>

      .tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 140px;
  background-color: #555;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 150%;
  left: 50%;
  margin-left: -75px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}
    .link {
        color: blue;
        cursor: pointer;
        font-style: italic;
    }
    .course {
        visibility: hidden;
        font: 10px arial, sans-serif;
        color: white;
        background: blue;
        cursor: text;
        padding: 6px;
        position: absolute;
        height: 90px;
        overflow-y: auto;
    }
    .link:hover .course { 
        visibility: visible; 
    }
table { border-collapse: collapse; }
    th { color: blue; padding: 5px 5px; }
    td { 
        border: 1px solid blue; 
        padding: 5px 5px; 
        text-align: center; 
    }
    td:hover .tip { visibility: visible; }
    .tip {
        visibility: hidden;
        font-size: small;
        background-color: blue;
        color: white;
        text-align: center;
        padding: 5px 5px;
        position: absolute;
    }
  </style>
 <script>
class Course {
constructor(coursename,examtime,examdate,room){
this.coursename=coursename
this.examtime=examtime
this.examdate=examdate
this.room=room
}
toString () {
    return this.coursename + " " + this.examdate
}
}
class Student {
constructor(id,name,gpa,courses){
this.id=id
this.name=name
this.gpa=gpa
this.courses= courses
}
toString () {
    return this.id +" "+ this.name
}
}
class Database {
    constructor(){
        this.urlS = document.getElementById("linktxt").value;
        //this.Courses = new Map();        
        this.Students = new Map();
        this.readStudents();
    }
readStudents() {
    console.log("readStudents "+this.urlS);
    fetch(this.urlS)
    .then(r => r.text())
    .then(r => this.addStudent(r))   
    .then(r => this.printTable())
}


addStudent(txt){
   let msg = txt.length+" chars, ";
   let a = txt.split("\n");
   msg += a.length+" lines, ";
   for (let s of a) {
     let student = this.parseStudent(s);
     this.Students.set(student.id,student);
   }
   this.report(msg + this.Students.size+" students");
}
parseStudent(line){
	let s = line.split("\t");
    let courses = [];
    for (let i=3; i<s.length; i++) 
    courses.push(s[i]);
    const student = new Student(s[0],s[1],s[2],courses)
    return student
}
printTable(){
    var counter=1;
	
	var html="<tr><th></th><th>id</th><th>name</th><th>gpa</th><th>count</th><th>courses</th></tr>";
    let stu=db.Students;
    for(let a of stu){
        let b=Array.from(a);
            for (var i = 1; i < 2; i++) {
                if(b[i].name!=undefined){
                let c=b[i].courses;
                html+="<tr>";
                html+="<th>"+counter+"</th>"
                html+="<td>"+b[i].id+"</td>";
                html+="<td>"+b[i].name+"</td>";
                html+="<td>"+b[i].gpa+"</td>";
                html+="<td>"+c.length+"</td>";
                html+="<td><small><sup>"+b[i].courses+"</sup></small></td>";
                html+="</tr>";
    counter++;
                }
        }
    tablo.innerHTML = html;
    }
}
report(msg, id, list) {
    out.innerHTML += "<br> Fetched: "+this.urlS+"<br>"; msg += " "; 
    out.appendChild(document.createTextNode(msg));
    let n1;
    if (id) {
        n1 = document.createElement("span");
        n1.appendChild(document.createTextNode(id));
        n1.classList.add("link");
        out.appendChild(n1); msg += id;
        //n1.addEventListener("click", doClick);
    }
    if (list) {
        let n2 = document.createElement("span");
        n2.appendChild(document.createTextNode(""));
        n2.innerHTML += list.join("<br>");
        n2.classList.add("course");
        if (n1) n1.appendChild(n2);
    }
    console.log(msg);
}
doClick(evt) {
    //console.log(evt);
    let t = evt.target;
    //document.elementFromPoint(evt.clientX, evt.clientY);
    let s = t.innerText;
    if (/^\d+$/.test(s)) this.showStudent(s); //s contains digits
    else if (t = t.firstElementChild) {
        t.style.visibility = "";
        let hide = function () {
            t.style.visibility = "hidden";
        };
        setTimeout(hide, 500);
    }
}
}
function copyF() {
  var copyText = document.getElementById("example");
  copyText.select();
  document.execCommand("copy");
  alert("Copied the text: " + copyText.value);
}
 </script>
 </head>

<body>
<div class="w3-container w3-blue">
        <a href="https://mehmetalperenkurt.github.io/ileriprogramlama/">GitHub Repository</a>-
        <a href="https://mehmetalperenkurt.github.io/ileriprogramlama/work/hw3/index.html">HW3</a>-
        <a href="https://mehmetalperenkurt.github.io/ileriprogramlama/cw7/cw7.html">CW7</a>
<h2 id=title></h2>
<p><input class="w3-input" type=text id=linktxt  placeholder="" value="https://mehmetalperenkurt.github.io/ileriprogramlama/work/calisma/Students.txt" onchange="" style="width:280px">
<input type=button value="Renew " class="button" onClick="db=new Database();"></p>
Example Link<br><textarea id="example" style="width:250px; height: 85px;">https://mehmetalperenkurt.github.io/ileriprogramlama/work/calisma/Students2.txt</textarea><br>
<input type=button value="Copy to Clipboard" class="button" onClick="copyF()">
<p id="out"></p>
</div>
<table id="tablo"><tr><th></th><th>id</th><th>name</th><th>gpa</th><th>count</th><th>courses</th></tr></table>
<hr />
<p id="sample"></p>
<script>
    title.innerText = document.title;
    db = new Database();
    sample.innerText=db.printTable;
</script>
</body>
</html>
